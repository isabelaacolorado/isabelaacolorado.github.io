<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tree Boy & Flower Girl</title>
  <style>
    :root {
      --bg: #1e293b;
      --text: #e6eef8;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 20px auto;
      border: 3px solid #fff;
      background: #000;
    }
    #status {
      margin: 10px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>ðŸŒ³ Tree Boy & ðŸŒ¸ Flower Girl</h1>
  <p id="status">Level 1 - Demo</p>
  <canvas id="game" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const W = canvas.width;
    const H = canvas.height;

    // Controls
    const keys = {};
    window.addEventListener("keydown", e => keys[e.key] = true);
    window.addEventListener("keyup", e => keys[e.key] = false);

    function makePlayer(x, y, color, controls) {
      return { x, y, w: 30, h: 40, color, vy: 0, onGround: false, controls };
    }

    const treeBoy = makePlayer(50, 500, "green", { left: "ArrowLeft", right: "ArrowRight", jump: "ArrowUp" });
    const flowerGirl = makePlayer(100, 500, "pink", { left: "a", right: "d", jump: "w" });

    const gravity = 0.6;
    const jumpPower = -12;
    const moveSpeed = 4;

    let currentLevelIndex = 0;
    let level = null;

    const levels = [
      {
        solids: [
          { x: 0, y: 580, w: 800, h: 20 },
          { x: 200, y: 500, w: 100, h: 20 },
          { x: 400, y: 400, w: 100, h: 20 },
          { x: 600, y: 300, w: 100, h: 20 }
        ],
        hazards: [
          { x: 350, y: 565, w: 50, h: 15, type: "water" }
        ],
        exits: [
          { x: 700, y: 260, w: 40, h: 40 }
        ],
        moving: []
      },
      {
        solids: [
          { x: 0, y: 580, w: 800, h: 20 },
          { x: 150, y: 480, w: 120, h: 20 },
          { x: 350, y: 380, w: 120, h: 20 },
          { x: 550, y: 280, w: 120, h: 20 }
        ],
        hazards: [
          { x: 250, y: 565, w: 80, h: 15, type: "lava" }
        ],
        exits: [
          { x: 700, y: 240, w: 40, h: 40 }
        ],
        moving: [
          { x: 100, y: 420, w: 100, h: 18, vx: -1.5, vy: 0, rangeMin: 180, rangeMax: 420, axis: "x" }
        ]
      }
    ];

    function loadLevel(i) {
      currentLevelIndex = i;
      level = JSON.parse(JSON.stringify(levels[i]));
      treeBoy.x = 50; treeBoy.y = 500; treeBoy.vy = 0;
      flowerGirl.x = 100; flowerGirl.y = 500; flowerGirl.vy = 0;
      document.getElementById("status").textContent = `Level ${i+1} - Demo`;
    }

    function rectsOverlap(a, b) {
      return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
    }

    function getSolids() {
      return [...level.solids, ...level.moving];
    }

    function updatePlayer(p) {
      // movement
      if (keys[p.controls.left]) p.x -= moveSpeed;
      if (keys[p.controls.right]) p.x += moveSpeed;
      if (keys[p.controls.jump] && p.onGround) {
        p.vy = jumpPower;
        p.onGround = false;
      }

      // gravity
      p.vy += gravity;
      p.y += p.vy;

      // collisions
      p.onGround = false;
      for (const s of getSolids()) {
        if (rectsOverlap(p, s)) {
          if (p.vy > 0 && p.y + p.h > s.y && p.y + p.h - p.vy <= s.y) {
            p.y = s.y - p.h;
            p.vy = 0;
            p.onGround = true;
          }
        }
      }

      // hazards
      for (const h of level.hazards) {
        if (rectsOverlap(p, h)) restartLevel();
      }

      // exits
      for (const ex of level.exits) {
        if (rectsOverlap(p, ex)) {
          if (p === treeBoy && rectsOverlap(flowerGirl, ex)) {
            if (currentLevelIndex + 1 < levels.length) loadLevel(currentLevelIndex+1);
            else document.getElementById("status").textContent = "ðŸŽ‰ You won!";
          }
        }
      }
    }

    function restartLevel() {
      loadLevel(currentLevelIndex);
    }

    function updateMoving() {
      level.moving.forEach(m => {
        if (m.axis === "x") {
          m.x += m.vx;
          if (m.x < m.rangeMin || m.x > m.rangeMax) m.vx *= -1;
        } else {
          m.y += m.vy;
          if (m.y < m.rangeMin || m.y > m.rangeMax) m.vy *= -1;
        }
      });
    }

    function drawRect(o, style) {
      ctx.fillStyle = style;
      ctx.fillRect(o.x, o.y, o.w, o.h);
    }

    function drawPlayer(p) {
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x, p.y, p.w, p.h);
    }

    function loop() {
      ctx.clearRect(0, 0, W, H);

      // draw level
      level.solids.forEach(s => drawRect(s, "#888"));
      level.moving.forEach(m => drawRect(m, "#aaa"));
      level.hazards.forEach(h => drawRect(h, h.type === "water" ? "blue" : "red"));
      level.exits.forEach(ex => drawRect(ex, "gold"));

      // update and draw players
      updatePlayer(treeBoy);
      updatePlayer(flowerGirl);
      drawPlayer(treeBoy);
      drawPlayer(flowerGirl);

      updateMoving();

      requestAnimationFrame(loop);
    }

    loadLevel(0);
    loop();
  </script>
</body>
</html>
