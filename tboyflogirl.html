<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tree Boy & Flower Girl</title>
  <style>
    :root {
      --bg: #1e293b;
      --text: #e6eef8;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 20px auto;
      border: 3px solid #fff;
      background: #87ceeb;
    }
    #status {
      margin: 10px;
      font-size: 18px;
    }

    #controls {
        margin-top: 8px;
        font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>ðŸŒ³ Tree Boy & ðŸŒ¸ Flower Girl</h1>
  <p id="status">Level 1 - Demo</p>
  <div id="controls">ðŸŒ³ Tree Boy: Arrow Keys | ðŸŒ¸ Flower Girl: WASD</div>
  <canvas id="game" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const W = canvas.width;
    const H = canvas.height;

    // Controls
    const keys = {};
    window.addEventListener("keydown", e => keys[e.key] = true);
    window.addEventListener("keyup", e => keys[e.key] = false);

    function makePlayer(x, y, color, controls) {
      return { x, y, w: 30, h: 40, color, vy: 0, onGround: false, controls, symbol };
    }

    const treeBoy = makePlayer(50, 500, "green", { left: "ArrowLeft", right: "ArrowRight", jump: "ArrowUp" }, "ðŸŒ³");
    const flowerGirl = makePlayer(100, 500, "pink", { left: "a", right: "d", jump: "w" }, "ðŸŒ¸");

    const gravity = 0.6;
    const jumpPower = -12;
    const moveSpeed = 4;

    let currentLevelIndex = 0;
    let level = null;

    const levels = [
      {
        solids: [
          { x: 0, y: 580, w: 800, h: 20 },
          { x: 200, y: 500, w: 100, h: 20 },
          { x: 400, y: 400, w: 100, h: 20 },
          { x: 600, y: 300, w: 100, h: 20 }
        ],
        hazards: [
          { x: 350, y: 565, w: 50, h: 15, type: "water" }
        ],
        exits: [
          { x: 700, y: 260, w: 40, h: 40 }
        ],
        moving: []
      },
      {
        solids: [
          { x: 0, y: 580, w: 800, h: 20 },
          { x: 150, y: 480, w: 120, h: 20 },
          { x: 350, y: 380, w: 120, h: 20 },
          { x: 550, y: 280, w: 120, h: 20 }
        ],
        hazards: [
          { x: 250, y: 565, w: 80, h: 15, type: "lava" }
        ],
        exits: [
          { x: 700, y: 240, w: 40, h: 40 }
        ],
        moving: [
          { x: 100, y: 420, w: 100, h: 18, vx: -1.5, vy: 0, rangeMin: 180, rangeMax: 420, axis: "x" }
        ]
      }
    ];

    function loadLevel(i) {
      currentLevelIndex = i;
      level = JSON.parse(JSON.stringify(levels[i]));
      treeBoy.x = 50; treeBoy.y = 500; treeBoy.vy = 0;
      flowerGirl.x = 100; flowerGirl.y = 500; flowerGirl.vy = 0;
      document.getElementById("status").textContent = `Level ${i+1} - Demo`;
    }

    function rectsOverlap(a, b) {
      return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
    }

    function getSolids() {
      return [...level.solids, ...level.moving];
    }

    function updatePlayer(p) {
      // movement
      if (keys[p.controls.left]) p.x -= moveSpeed;
      if (keys[p.controls.right]) p.x += moveSpeed;
      if (keys[p.controls.jump] && p.onGround) {
        p.vy = jumpPower;
        p.onGround = false;
      }

      // gravity
      p.vy += gravity;
      p.y += p.vy;

      // collisions
      p.onGround = false;
      for (const s of getSolids()) {
        if (rectsOverlap(p, s)) {
          if (p.vy > 0 && p.y + p.h > s.y && p.y + p.h - p.vy <= s.y) {
            p.y = s.y - p.h;
            p.vy = 0;
            p.onGround = true;
          }
        }
      }

      // hazards
      for (const h of level.hazards) {
        if (rectsOverlap(p, h)) restartLevel();
      }

      // exits
      for (const ex of level.exits) {
        if (rectsOverlap(p, ex)) {
          if (p === treeBoy && rectsOverlap(flowerGirl, ex)) {
            if (currentLevelIndex + 1 < levels.length) loadLevel(currentLevelIndex+1);
            else document.getElementById("status").textContent = "ðŸŽ‰ You won!";
          }
        }
      }
    }

    function restartLevel() {
      loadLevel(currentLevelIndex);
    }

    function updateMoving() {
      level.moving.forEach(m => {
        if (m.axis === "x") {
          m.x += m.vx;
          if (m.x < m.rangeMin || m.x > m.rangeMax) m.vx *= -1;
        } else {
          m.y += m.vy;
          if (m.y < m.rangeMin || m.y > m.rangeMax) m.vy *= -1;
        }
      });
    }

    function drawCloud(x, y) {
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, Math.PI*2);
        ctx.arc(x+25, y+10, 25,0, Math.PI*2);
        ctx.arc(x-25, y+10, 25, 0, Math.PI*2);
        ctx.arc(x, y+20, 20, 0, Math.PI*2);
        ctx.fill();
    }

    function drawTree(x,y) {
        ctx.fillStyle = "#8B4513";
        ctx.fillRect(x+15, y, 20, 40);
        ctx.fillStyle = "green";
        ctx.beginPath();
        ctx.arc(x+25, y, 30, 0, Math.PI*2);
        ctx.fill();
    }

    function drawFlower(x,y) {
        ctx.fillStyle = "pink";
        for (let i=0; i<5; i++) {
            let angle = i * (Math.PI*2/5);
            ctx.beginPath();
            ctx.arc(x + Math.cos(angle)*10, y + Math.sin(angle)*10, 6, 0, Math.PI*2);
            ctx.fill();
        }
        ctx.fillStyle = "yellow";
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI*2);
        ctx.fill();
    }

    function drawPlatform(p) {
        ctx.fillStyle = "#654321";
        ctx.fillRect(p.x, p.y, p.w, p.h);
        ctx.fillStyle = "#228B22";
        ctx.fillRect(p.x, p.y, p.w, 5);
    }

    function drawPlayer(p) {
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x, p.y, p.w, p.h);
      ctx.font = "20px Arial";
      ctx.fillText(p.symbol, p.x+3, p.y+25);
    }

    function drawHazard(h) {
        if (h.type == "water") {
            ctx.fillStyle = "blue";
            ctx.fillRect(h.x, h.y, h.w, h.h);
            ctx.fillStyle = "lightblue";
            ctx.fillRect(h.x, h.y, h.w, 3);
        } else if (h.type == "lava") {
            ctx.fillStyle = "red";
            ctx.fillRect(h.x, h.y, h.w, h.h);
            ctx.fillStyle = "orange";
            ctx.fillRect(h.w, h.y, h.w, 3);
        }
    }

    function drawExit(ex) {
        ctx.fillStyle = "yellow";
        ctx.beginPath();
        ctx.arc(ex.x + ex.w/2, ex.y + ex.h/2, 20, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = "white";
        ctx.stroke();
    }

    function loop() {

      ctx.clearRect(0, 0, W, H);

      drawCloud(100, 100);
      drawCloud(300, 80);
      drawCloud(600, 120);

      drawTree(50, 520);
      drawTree(700, 520);
      drawFlower(200, 570);
      drawFlower(250, 570);

      // draw level
//      level.solids.forEach(s => drawRect(s, "#888"));
//      level.moving.forEach(m => drawRect(m, "#aaa"));
      level.solids.forEach(drawPlatform);
      level.moving.forEach(drawPlatform);
      level.hazards.forEach(drawHazard);
      level.exits.forEach(drawExit);

      // update and draw players
      updatePlayer(treeBoy);
      updatePlayer(flowerGirl);
      drawPlayer(treeBoy);
      drawPlayer(flowerGirl);

      updateMoving();

      requestAnimationFrame(loop);
    }

    loadLevel(0);
    loop();
  </script>
</body>
</html>
